{% extends '::base.html.twig' %}

{% block body -%}
<div class="page-header">
    <div class="icon">
        <span class="ico-eye-open"></span>
    </div>
    <h1>Audit Hospital</h1>
</div>
{% set span = 3 %}
{% for domanda in slc %}
    {% if loop.index % 4 == 1 %}
    <div class="row-fluid">
        {% if loop.length - loop.index == 2 %}
            {% set span = 4 %}
        {% endif %}
        {% if loop.length - loop.index == 1 %}
            {% set span = 6 %}
        {% endif %}
        {% if loop.length - loop.index == 0 %}
            {% set span = 12 %}
        {% endif %}
    {% endif %}
    {% if loop.first %}
            <div class="span12">
                <div class="block">
                    <div class="audit padding-10 no-margin" style="border: 1px solid #c9c9c9; background: #e9e9e9; height: 40px;">
                        <form action="{{ path('claims-h-audit_show_all') }}" method="get" style="margin-top: 5px;">
                            <div class="input-group" style="line-height: 25px; text-align: center;">
                                <input class="form-control" type="text" autocomplete="off" style="width: 200px;" placeholder="Claimant name" name="ricerca[claimant]" value="{% if app.request.get('ricerca') %}{{ app.request.get('ricerca').claimant }}{% endif %}">
                                <button type="submit" class="btn red">Search</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row-fluid">    
        {% endif %}
        <div class="span{{ span }}">
            <div class="block">
                <div class="audit padding-10 no-margin" style="border: 1px solid #c9c9c9; background: #e9e9e9;">
                    <b>{{ domanda.question.domandaLocale(app.user.locale) }}</b><br/>
                    {{ domanda.tot|number_format(2, ',', '.') }} â‚¬
                    <small>({{domanda.n}} claims)</small>
                </div>
            </div>
        </div>
    {% if loop.index % 4 == 0 or loop.last %}
        </div>
    {% endif %}
{% endfor %}
<div class="row-fluid">
    <div class="span12">
        <div class="block">
            <div class="data-fluid">
                <table class="table grid" cellpadding="0" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Site</th>
                            <th>Date</th>
                            <th>Notes</th>
                            <th>Practices</th>
                            <th>Questions</th>
                            <th width="200">Global Progress</th>
                            <th width="80" class="TAC">Op.</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for entity in entities %}
                        <tr>                            
                            <td>
                                <a href="{{ path('claims-h-audit_edit', { 'id': entity.id }) }}">{{ entity.luogo }}</a>
                            </td>
                            <td>{% if entity.giorno %}{{ entity.giorno|date('d/m/Y') }}{% endif %}</td>
                            <td>{{ entity.note }}{% if entity.note %}<br/>{% endif %}{% if entity.cliente %}<small>created by {{ entity.cliente.nome }}</small>{% endif %}</td>
                            <td>
                                <a href="{{ path('claims-h-audit-file', { 'audit': entity.id }) }}">{{ entity.pratiche|length }}</a>
                            </td>
                            <td>
                                <a href="{{ path('claims-h-audit-questions', { 'id': entity.id }) }}">{{ entity.question|length }}</a>
                            </td>
                            <td>
                                {% set divisore = (entity.question|length * entity.pratiche|length) %}
                                {% if divisore == 0 %}
                                    {% set divisore = 1 %}
                                {% endif %}
                                {% set percentuale = (100 * entity.responses) / divisore %}
                                <div class="bar tip" style="width: {{ percentuale|number_format(2) }}%;" data-original-title="{{ percentuale|number_format(2) }}%"></div>
                                {{ percentuale|number_format(3) }}% ({{ entity.responses }}/{{ entity.question|length * entity.pratiche|length }})
                            </td>
                            <td>
                                {% include ":commons:show.html.twig" with {'route': path('claims-h-audit_show', { 'id': entity.id })} %}
                                {% include ":commons:star.html.twig" with {'route': path('claims-h-audit_risposte', { 'id': entity.id }), 'enable': true} %}
                                {% if jf_mode == 'offline' %}
                                    {% include ":commons:download.html.twig" with {'route': path('sync_claims-h-audit-fetch-audit', { 'id': entity.remoteId })} %}                    
                                {% endif %}
                                {% if jf_mode == 'online' %}
                                    {% include ":commons:delete.html.twig" with {'route': path('claims-h-audit_delete', { 'id': entity.id }), 'disable': entity.cliente.id != app.user.cliente.id, 'question': 'You want to delete the audit ' ~ entity.luogo } %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                
                
        </tbody>
    </table>

{% endblock %}
