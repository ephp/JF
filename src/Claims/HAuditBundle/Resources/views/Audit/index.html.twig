{% extends '::base.html.twig' %}

{% block body -%}
<div class="page-header">
    <div class="icon">
        <span class="ico-eye-open"></span>
    </div>
    <h1>Audit Hospital</h1>
</div>
<div class="row-fluid">
    <div class="span12">
        <div class="block">
            <div class="data-fluid">
                <table class="table grid" cellpadding="0" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Site</th>
                            <th>Date</th>
                            <th>Notes</th>
                            <th>Practices</th>
                            <th>Questions</th>
                            <th width="200">Global Progress</th>
                            <th width="80" class="TAC">Op.</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for entity in entities %}
                        <tr>                            
                            <td>
                                <a href="{{ path('claims-h-audit_edit', { 'id': entity.id }) }}">{{ entity.luogo }}</a>
                            </td>
                            <td>{% if entity.giorno %}{{ entity.giorno|date('d/m/Y') }}{% endif %}</td>
                            <td>{{ entity.note }}{% if entity.note %}<br/>{% endif %}<small>created by {{ entity.cliente.nome }}</small></td>
                            <td>
                                <a href="{{ path('claims-h-audit-file', { 'audit': entity.id }) }}">{{ entity.pratiche|length }}</a>
                            </td>
                            <td>
                                <a href="{{ path('claims-h-audit-questions', { 'id': entity.id }) }}">{{ entity.question|length }}</a>
                            </td>
                            <td>
                                {% set divisore = (entity.question|length * entity.pratiche|length) %}
                                {% if divisore == 0 %}
                                    {% set divisore = 1 %}
                                {% endif %}
                                {% set percentuale = (100 * entity.responses) / divisore %}
                                <div class="bar tip" style="width: {{ percentuale|number_format(2) }}%;" data-original-title="{{ percentuale|number_format(2) }}%"></div>
                                {{ percentuale|number_format(3) }}% ({{ entity.responses }}/{{ entity.question|length * entity.pratiche|length }})
                            </td>
                            <td>
                                {% include ":commons:show.html.twig" with {'route': path('claims-h-audit_show', { 'id': entity.id })} %}
                                {% include ":commons:download.html.twig" with {'route': path('claims-h-audit-xls', { 'id': entity.id })} %}                    
                                {% include ":commons:star.html.twig" with {'route': path('claims-h-audit_risposte', { 'id': entity.id }), 'enable': true} %}
                                {% include ":commons:delete.html.twig" with {'route': path('claims-h-audit_delete', { 'id': entity.id }), 'disable': entity.cliente.id != app.user.cliente.id, 'question': 'You want to delete the audit ' ~ entity.luogo } %}
                            </td>
                        </tr>
                    {% endfor %}
                
                
        </tbody>
    </table>

{% endblock %}
