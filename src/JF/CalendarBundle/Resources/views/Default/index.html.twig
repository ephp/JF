{% extends '::base.html.twig' %}

{% block body -%}
<div class="page-header">
    <div class="icon">
        <span class="ico-calendar"></span>
    </div>
    <h1>Calendario personale</h1>
</div>

<div class="row-fluid">
    <div class="span8">
        <div class="block calendar">
            <div id="mydatepicker"></div>
        </div>
    </div>
    <div class="span4">
        <div class="block">
            <a href="#fb_aggiungi_evento" class="fancybox icon"><span class="label label-success ico-calendar"> Aggiungi data</span></a>

            {% for label, cal in eventi %}
            <h5>{{ label }}</h5>
            <dl>
                {% for evento in cal.eventi %}
                    <dt onclick="$('#d_{{ evento.id }}').toggle();">{{ evento.dataOra|date('d-m-Y') }} - {{ evento.titolo }}</dt>
                    <dd id="d_{{ evento.id }}" style="display: none">{{ evento.note }}</dd>
                {% endfor %}
            </dl>
            {% endfor %}
        </div>
    </div>
</div>

{% render(controller("JFCalendarBundle:Render:nuovoEvento")) %}

<script type="text/javascript">
    var giorni = {{ giorni|raw }};
    $( "#mydatepicker" ).datepicker({
        dateFormat: 'dd-mm-yy',
        closeText: 'Chiudi', 
        prevText: 'Perc.', 
        nextText: 'Prox.', 
        currentText: 'Oggi', 
        monthNames: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
        monthNamesShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
        dayNames: ['Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato', 'Domenica'], 
        dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'], 
        dayNamesMin: ['D', 'L', 'Ma', 'Me', 'G', 'V', 'S'], 
        firstDay: 1,
        weekHeader: "S", 
        onSelect: function(date){
            setGiorno(giorni);
            alert(date);
        },
        onChangeMonthYear: function(year, month) {
            setGiorno(giorni);
            alert(month+'/'+year);
        }
    });
    
    setGiorno(giorni);
        
    function setGiorno(giorni) {
        $.each(giorni, function(giorno, val) {
            $('.calendar td').find('a').each(function() {
                $this = $(this);
                if($this.html() == giorno) {
                    $.each(val.tipo, function(label, v) {
                        $this.after('<div class="nscal '+v.css+'" title="'+label+': '+v.n+' event'+(v.n === 1 ? 'o' : 'i')+'">'+v.n+'</div>');
                    });
                    $this.after('<div class="ncal">'+val.tot+'</div>');
                }
            });
        });
    }
</script>   
{% endblock %}
